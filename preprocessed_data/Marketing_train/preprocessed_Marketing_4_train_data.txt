understand market mix model meta ’ robyn | rochan nehet | mediumopen appsign upsign inwritesign upsign inunderstand market mix model meta ’ robynrochan nehete·follow13 min read·jun 5 , 2023 -- 2listensharelast night watch movi ‘ air ’ friend blown away amount risk shown taken film.it got think , next michael jordan readi support small-scal brand , would go market budget first place ? suddenli got flashback method encount previou experi , market mix model . articl , seek explor open-sourc librari mmm call robyn , develop meta . , market mix model ( mmm ) ? market mix model ( mmm ) statist analysi techniqu use measur evalu impact variou market variabl sale key perform indic . involv analyz histor data quantifi effect market activ advertis , promot , price , distribut channel , determin individu combin contribut busi outcom . mmm help busi optim market strategi identifi effect alloc resourc understand roi differ market invest . 's like put market ingredi big pot see delici dish come ! brand decid perform mmm budget , would ? 3 wide accept method go , order decreas amount invest requir increas number resourc required:3rd parti vendor ( $ $ $ ) : 3rd parti vendor special mmm nielsen . drive entir engag provid high level consultancymmm saa product ( $ $ ) : product market analyt edg provid mmm solutionsopen sourc solut ( $ ) : possibl brand drive mmm effort use open sourc librari robyn , open sourc r project develop meta ’ market scienc divis comprehens documentation.each pro con . whatev choos , follow common step involv : data collect : gather relev data market activ sale understand impact differ element market mix.data analysi : analyz collect data identifi pattern , correl , trend reveal effect market efforts.vari select : select key variabl factor significantli influenc sale market performance.model build : develop statist model quantifi relationship market variabl sale outcomes.model valid : test valid accuraci reliabl model ensur effect predict futur outcomes.scenario simul : run simul “ what-if ” scenario assess potenti impact chang market strategi variables.for purpos , use simul dataset robyn.robyn use facebook ’ prophet perform time seri decomposit , ridg regress order regular multi-collinear prevent overfit , facebook ’ hyperparamet optim librari nevergrad.data explor featur engineeringfollow dataset look like : robyn ’ dt_simulated_weekli datasetw would input dataset robyn use robyn_input ( ) methodfor mmm , gener weekli data use daili data tend noisi . common recommend least 2–3 year histor data , includ detail inform market activ , sale revenu data , relev variabl price , promot , extern factor ( e.g. , econom indic ) . data avail , better model captur season , trend , pattern . robyn also support prophet ’ holiday data simpli need specifi countri code ( eg . us , de ) make use it.our depend variabl would revenu , busi demand , choos convers well . one depend variable.paid media variabl : media variabl clear market spend fall categori . includ tv , hous advertis ( eg . billboard ) , facebook ( facebook_i = impress , facebook_ = spend ) , search click . exposur level metric , use impress , click grp ( gross rate point = reach % * avg . frequenc impress ) .while defin channel , optimum split channel sub-channel better perform . exampl , facebook ad campaign real world split fb_prospect ( acquir peopl familiar product ) fb_retarget ( exist custom ) context variabl : includ variabl paid organ media help explain depend variabl . specifi context variabl ( context_var ) robyn competitor sale , price promot event , temperatur , unemploy rate , cpi covid . one focu point data collect phase.organ variabl : market activ without clear market spend fall categori . would includ social media post , push notif , newslett send organic_var variabl . type variabl within robyn , support defin relationship variabl default , posit neg . also forc context organ variabl categor use factor_var variable.defin window : window definit give us option select model window would best describ busi . especi help busi keep chang time . exampl , ad channel instagram may profit previous satur due competition.adstockadstock concept use market advertis analyt captur linger effect carryov impact past advertis exposur consum behavior , specif diminish return ( decreas margin return certain satur point spend ) . robyn , choos 3 type adstocks:1 . geometr — fix decay rate time , requir 1 paramet . run model faster others.2 . weibul cdf — flexibl decay rate 2 paramet control s-shape decay inflect point decay curve.3 . weibul pdf — flexibl decay rate 2 paramet , differ pdf offer lag effect.i chose geometr model . depend upon choic adstock chosen , specifi rang hyperparamet model.saturationrobyn util hill function reflect satur media channel . hill function two-parametr function robyn alpha gamma : alpha control shape curv exponenti s-shape . recommend bound c ( 0.5 , 3 ) — note larger alpha , s-shape smaller alpha , c-shape.gamma control inflexion point . recommend bound c ( 0.3 , 1 ) — note larger gamma , later inflect point respons curve.prophet season decompositionprophet meta open sourc code forecast time seri data . prophet automat includ robyn code decompos data trend , season , holiday , weekday impact , order improv model fit abil forecast . follow time seri decomposit prophet within robyn look like : time seri decomposit prophetoveral inputcollect variabl robyn_input would look like : inputcollect < - robyn_input ( dt_input = dt_simulated_weekli , dt_holiday = dt_prophet_holiday , date_var = `` date '' , # date format must `` 2020-01-01 '' dep_var = `` revenu '' , # one depend variabl dep_var_typ = `` revenu '' , # `` revenu '' ( roi ) `` convers '' ( cpa ) prophet_var = c ( `` trend '' , `` season '' , `` holiday '' ) , # `` trend '' , '' season '' , `` weekday '' & `` holiday '' prophet_countri = `` de '' , # input one countri . dt_prophet_holiday includ 59 countri default context_var = c ( `` competitor_sales_b '' , `` event '' ) , # e.g . competitor , discount , unemploy etc paid_media_spend = c ( `` tv_ '' , `` ooh_ '' , `` print_ '' , `` facebook_ '' , `` search_ '' ) , # mandatori input paid_media_var = c ( `` tv_ '' , `` ooh_ '' , `` print_ '' , `` facebook_i '' , `` search_clicks_p '' ) , # mandatori . organic_var = `` newslett '' , # market activ without media spend factor_var = c ( `` event '' ) , # forc variabl context_var organic_var categor window_start = `` 2016-01-01 '' , window_end = `` 2018-12-31 '' , adstock = `` geometr '' # geometr , weibull_cdf weibull_pdf . ) model techniqu ​mmm use regress , aim deriv equat describ depend variabl high explain . although , also replac model techniqu lesser explain ( overcom use shap ) cover article.whil use regress , overfit , multicollinear commonli address issu regress analysi . use vif detect multicollinear edavif seen 5 independ variabl , henc multicollinearitybut address issu togeth use regular techniqu . robyn use ridg regress , shrink coeffici toward zero variabl minor contribut depend variable.model selectionrobyn use nevergrad , optim librari develop facebook hyperparamet tune . select optim model , look 2 main evalu criteria iter obtain pareto-front chart : nrmse : normal root mean squar error tell us mani time model went wrong . root mean squar error use compar differ model . howev , rmse ’ perform well compar model fit differ respons variabl respons variabl standard , log-transform , otherwis modifi . overcom issu , nrmse use instead.decomp.rssd : decomposit root sum squar distanc also refer busi error . tell us whether model go unrealist . eg . put 80 % budget tiktok robyn would assign impact tiktok 0 % , ’ make sens . model go unrealisticpareto front graph model select nevergradoutputmodel < - robyn_run ( inputcollect = inputcollect , # feed model specif core = null , # null default ( max avail - 1 ) iter = 2000 , # 2000 recommend dummi dataset calibr trial = 5 , # 5 recommend dummi dataset ts_valid = true , # 3-way-split time seri nrmse valid . add_penalty_factor = fals # experiment featur . use caution . ) print ( outputmodel ) model calibrationcalibr tell us confid model predict . highli recommend step market mix model given prior increment test perform releas market budget.it possibl obtain ground truth calibr model test advertis oper subset consist 2 group : control test . control group expos ad revenue/convers obtain would natur baselin , wherea test group would subject advertis correspond revenue/convers would obtain . use two output , calcul correspond lift metric . control test group divid people-bas , geograph , basi differ devic . longer test studi , long tail effect captured.robyn take calibr data input model , enabl nevergrad use mape ( mean absolut percentag error ) addit two evalu metrics.calibration_input < - data.fram ( # channel name must paid_media_var channel = c ( `` facebook_ '' , `` tv_ '' , `` facebook_s+search_ '' , `` newslett '' ) , # liftstartd must within input data rang liftstartd = as.dat ( c ( `` 2018-05-01 '' , `` 2018-04-03 '' , `` 2018-07-01 '' , `` 2017-12-01 '' ) ) , # liftendd must within input data rang liftendd = as.dat ( c ( `` 2018-06-10 '' , `` 2018-06-03 '' , `` 2018-07-20 '' , `` 2017-12-31 '' ) ) , # provid valu must test campaign level model metric dep_var_typ liftab = c ( 400000 , 300000 , 700000 , 200 ) , # spend within experi : match within 10 % error spend date rang channel dt_input spend = c ( 421000 , 7100 , 350000 , 0 ) , # confid : frequentist experi , may use 1 - pvalu confid = c ( 0.85 , 0.8 , 0.99 , 0.95 ) , # kpi measur : must match dep_var metric = c ( `` revenu '' , `` revenu '' , `` revenu '' , `` revenu '' ) , # either `` immedi '' `` total '' . experiment input like facebook lift , `` immedi '' recommend . calibration_scop = c ( `` immedi '' , `` immedi '' , `` immedi '' , `` immedi '' ) ) inputcollect < - robyn_input ( inputcollect = inputcollect , calibration_input = calibration_input ) interpret model resultsour model approach give us best model obtain lower left part pareto-front chart . analyz perform model along effect variabl combin contribut toward busi outcom . robyn give us differ visual model one-pag model compare.outputcollect < - robyn_output ( inputcollect , outputmodel , pareto_front = `` auto '' , # automat pick mani pareto-front fill min_candid ( 100 ) # min_candid = 100 , # top pareto model cluster . default 100 # calibration_constraint = 0.1 , # rang c ( 0.01 , 0.1 ) & default 0.1 csv_out = `` pareto '' , # `` pareto '' , `` '' , null ( none ) cluster = true , # set true cluster similar model roa . see ? robyn_clust export = create_fil , # creat file local plot_fold = robyn_directori , # path plot export file creation plot_pareto = create_fil # set fals deactiv plot save model one-pag ) print ( outputcollect ) one pager report model output robyn_onepagersmyonepag < - robyn_onepag ( inputcollect , outputcollect , select_model , export = fals ) top , see r-squar ( r2 ) valu along nrmse , decomp : rssd , mape . r-squar valu tell us much varianc depend variabl explain independ variabl regress , typic refer good fit model observ data.th waterfal chart tell us much % revenu attribut channel . exampl , competitor 's sale attribut 49.3 % revenu , mean competitor sell , trigger convers revenu brand well . indic target audienc activ compar evalu option differ competitor make purchas decision.th actual vs predict respons show good model came predict revenu time.th total spend % vs effect % horizont bar graph show us much end spend channel effect channelth respons curv mean spend channel , sometim call satur curv , indic specif media channel ’ spend optim level approach satur therefor suggest potenti budget reallocation.th adstock decay chart repres , averag , percentag decay rate channel . higher decay rate , time would take specif media channel effect initi exposure.th fit vs residu chart help us identifi outlier point . help us identifi variabl may left analysi ( exampl covid ) consid differ tradeoff reconsid variabl might left , select model meet busi need basi analysi , budget allocation.budget allocationth crucial part decision-mak involv consid what-if situat budget . section , take look answer differ question ask model result decision-makers.for everi select model result , robyn_alloc ( ) function appli get optim budget mix maxim respons ( revenu convers ) . fun partscenario 1 : maximum return obtain given certain spend ? answer , use robyn alloc followsallocatorcollect < - robyn_alloc ( inputcollect = inputcollect , outputcollect = outputcollect , select_model = select_model , # select model # date_rang = `` last_10 '' , use specifi across period question ask . last 10 period , c ( `` 2018-10-22 '' , `` 2018-12-31 '' ) . default = latest month total_budget = 5000000 , # total budget date_rang period simul channel_constr_low = c ( 0.8 , 0.7 , 0.7 , 0.7 , 0.7 ) , # minimum spend channel channel_constr_up = c ( 1.2 , 1.5 , 1.5 , 1.5 , 1.5 ) , # maximum spend channel channel_constr_multipli = 3 , # customis bound extens wider insight scenario = `` max_respons '' , # need maxim respons variabl , revenu case export = create_fil ) budget alloc max roi , fix budget ( refer blue chart ) see keep total spend , increas roa 22.7 % realloc budget per channel per blue tabl . respons curv show us respons would look like amount spend give , show us initi point propos points.scenario 2 : much spend hit target roas/cpa x ? answer , use make small chang scenario paramet robyn alloc add target follow : allocatorcollect < - robyn_alloc ( inputcollect = inputcollect , outputcollect = outputcollect , select_model = select_model , # date_rang = null , # default last month initi period scenario = `` target_effici '' , target_valu = 2 , # custom target roa cpa valu accord busi need export = create_fil ) budget alloc target roa 2 ( refer blue chart ) observ order achiev return ad spend 2 , need decreas spend 24.6 % , realloc budget per channel shown blue tabl settl reduc revenu 19.1 % .you also obtain margin respons addit $ spent channel use robyn_respons metric valu = spend + $ code reproduc content within articl , along chart visual report , found github repositori here.refer : [ 1 ] robyn ’ webpag : http : //facebookexperimental.github.io/robyn/ [ 2 ] robyn cran document : http : //cran.r-project.org/web/packages/robyn/robyn.pdfmarketinganalyticsmarket mix modelingtim seri forecastingoptim -- -- 2followwritten rochan nehete19 followersmeet rochan , busi analyt student eager learn new thing data . 'm passion solv complex problem expand knowledge.followhelpstatusaboutcareersblogprivacytermstext speechteam